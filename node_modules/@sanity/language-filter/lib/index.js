"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react/jsx-runtime"),t=require("react"),n=require("sanity"),s=require("@sanity/icons"),a=require("@sanity/ui"),l=require("styled-components");const i=(e,t,n)=>!e.name.startsWith("locale")||n.includes(t.name);function r(e,t){const n=function(e){return"object"===e?.jsonType&&"document"===o(e).name}(e)&&e?.options?.languageFilter,s=!t.documentTypes;return!!(s&&!1!==n||!s&&n||e&&t.documentTypes?.includes(e.name))}function o(e){return e.type?o(e.type):e}const u="@sanity/plugin/language-filter/selected-languages";function c(e){const t=d(e).map((e=>e.id));let n=t;try{const e=window.localStorage.getItem(u);e&&(n=JSON.parse(e))}catch{}return s=t,n=n.filter((e=>s.includes(e))),n;var s}function d({supportedLanguages:e,defaultLanguages:t}){return Array.isArray(e)?e.filter((e=>!t?.includes(e.id))):[]}const g={options:{apiVersion:"2022-11-27",supportedLanguages:[],defaultLanguages:[],documentTypes:[],filterField:i},selectedLanguageIds:[],setSelectedLanguageIds:()=>console.error("LanguageFilterStudioContext not initialized")},p=t.createContext(g);function f(){return t.useContext(p)}const x=e=>Array.from(new Set(e)),m=l.styled(a.Box)`
  max-height: calc(100vh - 200px);
`;function h(){const{options:l}=f(),i=l.supportedLanguages.filter((e=>l.defaultLanguages?.includes(e.id))),r=l.supportedLanguages.filter((e=>!l.defaultLanguages?.includes(e.id))),[o,c]=t.useState(!1),{activeLanguages:g,allSelected:p,selectAll:h,selectNone:L,toggleLanguage:y}=function(){const{selectedLanguageIds:e,setSelectedLanguageIds:n,options:s}=f(),{defaultLanguages:a=[]}=s,l=t.useMemo((()=>d(s)),[s]),i=t.useCallback((e=>{var t;n(x([...a,...e])),t=x([...a,...e]),window.localStorage.setItem(u,JSON.stringify(t))}),[a,n]),r=t.useCallback((()=>i(l.map((e=>e.id)))),[i,l]),o=t.useCallback((()=>{i(a)}),[a,i]),c=t.useCallback((t=>{let n=e;n=n.includes(t)?n.filter((e=>e!==t)):x([...n,t]),i(n)}),[i,e]);return{activeLanguages:t.useMemo((()=>x([...a??[],...e])),[a,e]),allSelected:e.length===l.length+a.length,selectAll:r,selectNone:o,toggleLanguage:c}}(),[S,C]=t.useState(null),[T,b]=t.useState(null),k=t.useCallback((e=>{"ALL"===e.currentTarget.value?h():L()}),[h,L]),v=t.useCallback((()=>c((e=>!e))),[]),F=t.useCallback((()=>c(!1)),[]);a.useClickOutside(F,[S,T]);const I=l.supportedLanguages.length,[w,A]=t.useState(""),B=t.useCallback((e=>{e.currentTarget.value?A(e.currentTarget.value):A("")}),[]),O=I>4,q=/* @__PURE__ */e.jsx(m,{overflow:"auto",children:/* @__PURE__ */e.jsxs(a.Stack,{padding:1,space:1,children:[i.length>0&&/* @__PURE__ */e.jsxs(e.Fragment,{children:[i.map((t=>/* @__PURE__ */e.jsx(j,{id:t.id,title:t.title,selected:!0},t.id))),
/* @__PURE__ */e.jsx(a.Card,{borderTop:!0})]}),
/* @__PURE__ */e.jsx(a.Button,{mode:"bleed",onClick:k,justify:"flex-start",value:p?"NONE":"ALL",disabled:!!w,children:/* @__PURE__ */e.jsxs(a.Flex,{gap:3,align:"center",children:[
/* @__PURE__ */e.jsx(a.Text,{size:2,children:p?/* @__PURE__ */e.jsx(n.TextWithTone,{tone:"primary",children:/* @__PURE__ */e.jsx(s.EyeClosedIcon,{})}):/* @__PURE__ */e.jsx(s.EyeOpenIcon,{})}),
/* @__PURE__ */e.jsx(a.Box,{flex:1,children:/* @__PURE__ */e.jsx(a.Text,{children:p?"Hide all":"Show all"})})]})}),O?/* @__PURE__ */e.jsx(a.TextInput,{onChange:B,value:w,placeholder:"Filter languages"}):/* @__PURE__ */e.jsx(a.Card,{borderTop:!0}),r.filter((e=>!w||e.title.toLowerCase().includes(w.toLowerCase()))).map((t=>/* @__PURE__ */e.jsx(j,{id:t.id,onToggle:y,selected:g.includes(t.id),title:t.title},t.id)))]})}),N=g.length===I?"Showing all":`Showing ${g.length} / ${I}`;/* @__PURE__ */
return e.jsx(a.Popover,{animate:!0,content:q,open:o,portal:!0,ref:b,children:/* @__PURE__ */e.jsx(a.Button,{text:N,icon:s.TranslateIcon,mode:"bleed",onClick:v,ref:C,selected:o})})}function j(l){const{id:i,onToggle:r,selected:o,title:u}=l,c=t.useCallback((()=>{r&&r(i)}),[i,r]),d=!r;/* @__PURE__ */
return e.jsx(a.Button,{mode:"bleed",onClick:c,justify:"flex-start",disabled:d,children:/* @__PURE__ */e.jsxs(a.Flex,{gap:3,align:"center",children:[
/* @__PURE__ */e.jsx(a.Text,{size:2,children:o?/* @__PURE__ */e.jsx(n.TextWithTone,{tone:d?"default":"positive",children:/* @__PURE__ */e.jsx(s.CheckmarkCircleIcon,{})}):/* @__PURE__ */e.jsx(s.CircleIcon,{})}),
/* @__PURE__ */e.jsx(a.Box,{flex:1,children:/* @__PURE__ */e.jsx(a.Text,{children:u})}),
/* @__PURE__ */e.jsx(a.Badge,{children:i})]})})}function L(e){const{members:n,schemaType:s,renderDefault:a,...l}=e,{selectedLanguageIds:i,options:r}=f(),{filterField:o}=r;return a({...l,members:t.useMemo((()=>n.filter((e=>"field"===e.kind&&o(s,e,i)||"fieldSet"===e.kind||"error"===e.kind)).map((e=>"fieldSet"===e.kind?{...e,fieldSet:{...e.fieldSet,members:e.fieldSet.members.filter((e=>"field"===e.kind&&o(s,e,i)))}}:e))),[s,n,o,i]),schemaType:s,renderDefault:a})}const y=n.definePlugin((s=>{const a=()=>/* @__PURE__ */e.jsx(h,{}),l={...g.options,...s};return{name:"@sanity/language-filter",studio:{components:{layout:s=>function(s){const a=n.useClient({apiVersion:"2023-01-01"}),[l,i]=t.useState(Array.isArray(s.options.supportedLanguages)?s.options.supportedLanguages:[]);t.useEffect((()=>{let e=[];Array.isArray(s.options.supportedLanguages)||async function(t){e=await t(a,{}),i(e)}(s.options.supportedLanguages)}),[a,s.options.supportedLanguages]);const r=t.useMemo((()=>({...g.options,...s.options,supportedLanguages:l})),[s.options,l]),[o,u]=function(e){return t.useState((()=>[...e.defaultLanguages??[],...c(e)]))}(r);/* @__PURE__ */
return e.jsx(p.Provider,{value:{options:r,selectedLanguageIds:o,setSelectedLanguageIds:u},children:s.renderDefault(s)})}({...s,options:l})}},document:{unstable_languageFilter:(e,{schemaType:t,schema:n})=>r(n.get(t),s)?[...e,a]:e},form:{components:{input:t=>"root"!==t.id&&n.isObjectSchemaType(t.schemaType)?function(t){const{options:s}=f(),a=n.useFormValue(["_type"]);return r(n.useSchema().get(a),s)?/* @__PURE__ */e.jsx(L,{...t}):t.renderDefault(t)}(t):t.renderDefault(t)}}}}));exports.defaultFilterField=i,exports.isLanguageFilterEnabled=r,exports.languageFilter=y,exports.useLanguageFilterStudioContext=f;//# sourceMappingURL=index.js.map
