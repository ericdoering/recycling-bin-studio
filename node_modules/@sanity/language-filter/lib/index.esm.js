import{jsx as e,jsxs as t,Fragment as n}from"react/jsx-runtime";import{useState as i,createContext as a,useEffect as r,useMemo as l,useContext as o,useCallback as s}from"react";import{useClient as d,TextWithTone as u,useFormValue as c,useSchema as g,definePlugin as p,isObjectSchemaType as f}from"sanity";import{EyeClosedIcon as m,EyeOpenIcon as h,TranslateIcon as L,CheckmarkCircleIcon as y,CircleIcon as S}from"@sanity/icons";import{Box as T,useClickOutside as v,Stack as b,Card as w,Button as A,Flex as x,Text as I,TextInput as k,Popover as C,Badge as F}from"@sanity/ui";import{styled as N}from"styled-components";const j=(e,t,n)=>!e.name.startsWith("locale")||n.includes(t.name);function D(e,t){const n=function(e){return"object"===e?.jsonType&&"document"===z(e).name}(e)&&e?.options?.languageFilter,i=!t.documentTypes;return!!(i&&!1!==n||!i&&n||e&&t.documentTypes?.includes(e.name))}function z(e){return e.type?z(e.type):e}const O="@sanity/plugin/language-filter/selected-languages";function J(e){const t=V(e).map((e=>e.id));let n=t;try{const e=window.localStorage.getItem(O);e&&(n=JSON.parse(e))}catch{}return i=t,n=n.filter((e=>i.includes(e))),n;var i}function V({supportedLanguages:e,defaultLanguages:t}){return Array.isArray(e)?e.filter((e=>!t?.includes(e.id))):[]}const $={options:{apiVersion:"2022-11-27",supportedLanguages:[],defaultLanguages:[],documentTypes:[],filterField:j},selectedLanguageIds:[],setSelectedLanguageIds:()=>console.error("LanguageFilterStudioContext not initialized")},_=a($);function E(){return o(_)}const H=e=>Array.from(new Set(e)),P=N(T)`
  max-height: calc(100vh - 200px);
`;function W(){const{options:a}=E(),r=a.supportedLanguages.filter((e=>a.defaultLanguages?.includes(e.id))),o=a.supportedLanguages.filter((e=>!a.defaultLanguages?.includes(e.id))),[d,c]=i(!1),{activeLanguages:g,allSelected:p,selectAll:f,selectNone:y,toggleLanguage:S}=function(){const{selectedLanguageIds:e,setSelectedLanguageIds:t,options:n}=E(),{defaultLanguages:i=[]}=n,a=l((()=>V(n)),[n]),r=s((e=>{var n;t(H([...i,...e])),n=H([...i,...e]),window.localStorage.setItem(O,JSON.stringify(n))}),[i,t]),o=s((()=>r(a.map((e=>e.id)))),[r,a]),d=s((()=>{r(i)}),[i,r]),u=s((t=>{let n=e;n=n.includes(t)?n.filter((e=>e!==t)):H([...n,t]),r(n)}),[r,e]);return{activeLanguages:l((()=>H([...i??[],...e])),[i,e]),allSelected:e.length===a.length+i.length,selectAll:o,selectNone:d,toggleLanguage:u}}(),[F,N]=i(null),[j,D]=i(null),z=s((e=>{"ALL"===e.currentTarget.value?f():y()}),[f,y]),J=s((()=>c((e=>!e))),[]),$=s((()=>c(!1)),[]);v($,[F,j]);const _=a.supportedLanguages.length,[W,B]=i(""),G=s((e=>{e.currentTarget.value?B(e.currentTarget.value):B("")}),[]),K=_>4,M=/* @__PURE__ */e(P,{overflow:"auto",children:/* @__PURE__ */t(b,{padding:1,space:1,children:[r.length>0&&/* @__PURE__ */t(n,{children:[r.map((t=>/* @__PURE__ */e(q,{id:t.id,title:t.title,selected:!0},t.id))),
/* @__PURE__ */e(w,{borderTop:!0})]}),
/* @__PURE__ */e(A,{mode:"bleed",onClick:z,justify:"flex-start",value:p?"NONE":"ALL",disabled:!!W,children:/* @__PURE__ */t(x,{gap:3,align:"center",children:[
/* @__PURE__ */e(I,{size:2,children:p?/* @__PURE__ */e(u,{tone:"primary",children:/* @__PURE__ */e(m,{})}):/* @__PURE__ */e(h,{})}),
/* @__PURE__ */e(T,{flex:1,children:/* @__PURE__ */e(I,{children:p?"Hide all":"Show all"})})]})}),K?/* @__PURE__ */e(k,{onChange:G,value:W,placeholder:"Filter languages"}):/* @__PURE__ */e(w,{borderTop:!0}),o.filter((e=>!W||e.title.toLowerCase().includes(W.toLowerCase()))).map((t=>/* @__PURE__ */e(q,{id:t.id,onToggle:S,selected:g.includes(t.id),title:t.title},t.id)))]})}),Q=g.length===_?"Showing all":`Showing ${g.length} / ${_}`;/* @__PURE__ */
return e(C,{animate:!0,content:M,open:d,portal:!0,ref:D,children:/* @__PURE__ */e(A,{text:Q,icon:L,mode:"bleed",onClick:J,ref:N,selected:d})})}function q(n){const{id:i,onToggle:a,selected:r,title:l}=n,o=s((()=>{a&&a(i)}),[i,a]),d=!a;/* @__PURE__ */
return e(A,{mode:"bleed",onClick:o,justify:"flex-start",disabled:d,children:/* @__PURE__ */t(x,{gap:3,align:"center",children:[
/* @__PURE__ */e(I,{size:2,children:r?/* @__PURE__ */e(u,{tone:d?"default":"positive",children:/* @__PURE__ */e(y,{})}):/* @__PURE__ */e(S,{})}),
/* @__PURE__ */e(T,{flex:1,children:/* @__PURE__ */e(I,{children:l})}),
/* @__PURE__ */e(F,{children:i})]})})}function B(e){const{members:t,schemaType:n,renderDefault:i,...a}=e,{selectedLanguageIds:r,options:o}=E(),{filterField:s}=o;return i({...a,members:l((()=>t.filter((e=>"field"===e.kind&&s(n,e,r)||"fieldSet"===e.kind||"error"===e.kind)).map((e=>"fieldSet"===e.kind?{...e,fieldSet:{...e.fieldSet,members:e.fieldSet.members.filter((e=>"field"===e.kind&&s(n,e,r)))}}:e))),[n,t,s,r]),schemaType:n,renderDefault:i})}const G=p((t=>{const n=()=>/* @__PURE__ */e(W,{}),a={...$.options,...t};return{name:"@sanity/language-filter",studio:{components:{layout:t=>function(t){const n=d({apiVersion:"2023-01-01"}),[a,o]=i(Array.isArray(t.options.supportedLanguages)?t.options.supportedLanguages:[]);r((()=>{let e=[];Array.isArray(t.options.supportedLanguages)||async function(t){e=await t(n,{}),o(e)}(t.options.supportedLanguages)}),[n,t.options.supportedLanguages]);const s=l((()=>({...$.options,...t.options,supportedLanguages:a})),[t.options,a]),[u,c]=function(e){return i((()=>[...e.defaultLanguages??[],...J(e)]))}(s);/* @__PURE__ */
return e(_.Provider,{value:{options:s,selectedLanguageIds:u,setSelectedLanguageIds:c},children:t.renderDefault(t)})}({...t,options:a})}},document:{unstable_languageFilter:(e,{schemaType:i,schema:a})=>D(a.get(i),t)?[...e,n]:e},form:{components:{input:t=>"root"!==t.id&&f(t.schemaType)?function(t){const{options:n}=E(),i=c(["_type"]);return D(g().get(i),n)?/* @__PURE__ */e(B,{...t}):t.renderDefault(t)}(t):t.renderDefault(t)}}}}));export{j as defaultFilterField,D as isLanguageFilterEnabled,G as languageFilter,E as useLanguageFilterStudioContext};//# sourceMappingURL=index.esm.js.map
